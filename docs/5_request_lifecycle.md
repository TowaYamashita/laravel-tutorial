## チュートリアルのURL

https://laravel.com/docs/9.x/lifecycle

## メモ

### 1. エントリーポイント

- Laravelアプリケーションへのすべてのリクエストは public/index.php で受ける
- public/index.phpは以下の役割がある
  - Composerによって生成されたオートローダ定義を読み込む
  - bootstrap/app.php からLaravelアプリケーションインスタンスを取得する
  - サービスコンテナのインスタンスを作成する

### 2. HTTP/コンソール カーネル

- Laravelアプリケーションに入る要求の種類によって、HTTPカーネルかコンソルールカーネルに振り分けられる
- HTTPカーネル(app/Http/Kernel.php)は以下の役割がある
  - リクエストが実際に処理される前に行われる必要がある他のタスクを実行する
    - エラー処理やロギングの構成、アプリケーション環境の検知など
  - リクエストがアプリケーションによって処理される前に通過しなければならないHTTPミドルウェアのリストを定義する
    - HTTPセッションの読み書き、アプリケーションがメンテナンスモードであるかどうかの判断、CSRFトークンの検証など
  - HTTPカーネルのhandleメソッドシグネチャは Requestを受け取って、Responseを返すように定義されている
- コンソールカーネル(app/Console/Kernel.php)は以下の役割がある
  - 定期的に実行するスクリプトのスケジュールを定義する
    - スクリプトの他にも、Artisanコマンド、キューに投入するジョブ、シェルコマンド が扱える

### 3. サービスプロバイダ

- Laravelが提供する主要機能はサービスプロバイダによって構成され提供されている
- config/app.php の providers配列に使用するサービスプロバイダを定義して、これを使ってサービスコンテナへ登録する
- デフォルトのサービスプロバイダそのものは app/Providersディレクトリに格納されている

### 4. ルーティング

- ルーティングは、サービスプロバイダによって提供される App\Providers\RouteServiceProvider でルートファイルを読み込むことで行なっている
- ルーティングの流れ
  - アプリケーションを起動し、サービスプロバイダの登録を完了させる
  - リクエストをルータに渡す
  - ルータはリクエストをルートやコントローラに渡し、ルート固有のミドルウェアを実行する
    - ミドルウェアにはすべてのルートで実行するものもあれば、特定のルートまたはルートグループだけ実行するものもある
  - ミドルウェアをリクエストが通過できた場合は、ルートまたはコントローラメソッドが実行する

### 5. レスポンスの返却

- ルートまたはコントローラメソッドの実行によって返ってきたレスポンスをミドルウェアに渡す
- レスポンスがミドルウェアを通過したら、HTTPカーネルのhandleメソッドでレスポンスオブジェクトを返す
- 返ってきたレスポンスオブジェクトを使って、public/index.php の sendメソッドでユーザにレスポンスを返す